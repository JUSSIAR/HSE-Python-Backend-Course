# Blog API

Сервис для ведения блога с возможностью создания постов, комментариев и взаимодействия с ними.

## Основные возможности

### Посты
- Создание, просмотр, редактирование и удаление постов
- Просмотр самых популярных постов
- Просмотр постов с наибольшим количеством комментариев
- Возможность ставить и убирать лайки постам

### Комментарии
- Создание, просмотр, редактирование и удаление комментариев
- Просмотр самых популярных комментариев
- Возможность ставить и убирать лайки комментариям

## Начало работы

### Локальный запуск

1. Установка зависимостей:
```bash
cd web
pip install -r requirements.txt
```

2. Применение миграций:
```bash
python manage.py migrate
```

3. Загрузка тестовых данных:
```bash
python manage.py loaddata blog/fixtures/*.json
```

4. Запуск сервера:
```bash
python manage.py runserver
```

После запуска сервис будет доступен по адресу http://localhost:8000

### Запуск через Docker

Для запуска с помощью Docker:

1. Убедитесь, что у вас установлены Docker и Docker Compose

2. Запустите контейнеры:
```bash
cd web
docker-compose up --build
```

Сервис будет доступен по адресу http://localhost:8000

Дополнительные команды:
- Для остановки контейнеров: `docker-compose down`
- Для удаления всех данных (включая базу данных): `docker-compose down -v`

## API Endpoints

### Посты

#### Получение списка постов
```
GET /api/posts/
```
Возвращает список всех постов.

#### Создание нового поста
```
POST /api/posts/
```
Требует аутентификации. Тело запроса:
```json
{
    "title": "Заголовок поста",
    "content": "Содержание поста"
}
```

#### Получение конкретного поста
```
GET /api/posts/{id}/
```

#### Редактирование поста
```
PUT /api/posts/{id}/
```
Требует аутентификации. Тело запроса аналогично созданию поста.

#### Частичное обновление поста
```
PATCH /api/posts/{id}/
```
Требует аутентификации. В теле запроса указываются только обновляемые поля.

#### Удаление поста
```
DELETE /api/posts/{id}/
```
Требует аутентификации.

#### Самые популярные посты
```
GET /api/posts/most_liked/
```
Возвращает 5 постов с наибольшим количеством лайков.

#### Посты с наибольшим количеством комментариев
```
GET /api/posts/most_commented/
```
Возвращает 5 постов с наибольшим количеством комментариев.

#### Поставить/убрать лайк посту
```
POST /api/posts/{id}/toggle_like/
```
Требует аутентификации.

### Комментарии

#### Получение списка комментариев
```
GET /api/comments/
```
Возвращает список всех комментариев.

#### Создание нового комментария
```
POST /api/comments/
```
Требует аутентификации. Тело запроса:
```json
{
    "post": 1,
    "content": "Текст комментария"
}
```

#### Получение конкретного комментария
```
GET /api/comments/{id}/
```

#### Редактирование комментария
```
PUT /api/comments/{id}/
```
Требует аутентификации.

#### Удаление комментария
```
DELETE /api/comments/{id}/
```
Требует аутентификации.

#### Самые популярные комментарии
```
GET /api/comments/most_liked/
```
Возвращает 5 комментариев с наибольшим количеством лайков.

#### Поставить/убрать лайк комментарию
```
POST /api/comments/{id}/toggle_like/
```
Требует аутентификации.

## Документация API

Для более подробной документации API доступны следующие интерфейсы:

- Swagger UI: http://localhost:8000/swagger/
- ReDoc: http://localhost:8000/redoc/

## Аутентификация

Для выполнения операций, требующих аутентификации (создание, редактирование, удаление, лайки), необходимо быть авторизованным пользователем.

По умолчанию доступны следующие тестовые пользователи:

1. Администратор:
   - Логин: admin
   - Email: admin@example.com
   - Пароль: admin

2. Обычный пользователь:
   - Логин: user1
   - Email: user1@example.com
   - Пароль: user1

## Примеры использования

### Создание поста

```bash
curl -X POST http://localhost:8000/api/posts/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"title": "Мой первый пост", "content": "Привет, мир!"}'
```

### Получение популярных постов

```bash
curl http://localhost:8000/api/posts/most_liked/
```

### Добавление комментария

```bash
curl -X POST http://localhost:8000/api/comments/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"post": 1, "content": "Отличный пост!"}'
``` 